"use strict";(self.webpackChunkes_documentacion_devops=self.webpackChunkes_documentacion_devops||[]).push([[786],{8453:(e,a,n)=>{n.d(a,{R:()=>r,x:()=>c});var o=n(6540);const l={},s=o.createContext(l);function r(e){const a=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),o.createElement(s.Provider,{value:a},e.children)}},9487:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"kubernetes/troubleshooting/kubectl-lb-timeout","title":"Acceso a kubectl desde Local falla (Timeout a LB)","description":"S\xedntoma","source":"@site/docs/kubernetes/troubleshooting/02-kubectl-lb-timeout.md","sourceDirName":"kubernetes/troubleshooting","slug":"/kubernetes/troubleshooting/kubectl-lb-timeout","permalink":"/devsecops-playground/docs/kubernetes/troubleshooting/kubectl-lb-timeout","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/kubernetes/troubleshooting/02-kubectl-lb-timeout.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Acceso a kubectl desde Local falla (Timeout a LB)"},"sidebar":"tutorialSidebar","previous":{"title":"CoreDNS Pods en Pending","permalink":"/devsecops-playground/docs/kubernetes/troubleshooting/coredns-pending"},"next":{"title":"Calico Node Pod en 0/1 Ready","permalink":"/devsecops-playground/docs/kubernetes/troubleshooting/calico-node-notready-overview"}}');var l=n(4848),s=n(8453);const r={sidebar_position:2,title:"Acceso a kubectl desde Local falla (Timeout a LB)"},c="Problema: Acceso a kubectl desde Local falla (Timeout)",i={},d=[{value:"S\xedntoma",id:"s\xedntoma",level:2},{value:"Diagn\xf3stico",id:"diagn\xf3stico",level:2},{value:"Causa Ra\xedz",id:"causa-ra\xedz",level:2},{value:"Soluci\xf3n",id:"soluci\xf3n",level:2},{value:"Pasos en el servidor del balanceador (192.168.100.7):",id:"pasos-en-el-servidor-del-balanceador-1921681007",level:3},{value:"Verificaci\xf3n",id:"verificaci\xf3n",level:2}];function t(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.header,{children:(0,l.jsx)(a.h1,{id:"problema-acceso-a-kubectl-desde-local-falla-timeout",children:"Problema: Acceso a kubectl desde Local falla (Timeout)"})}),"\n",(0,l.jsx)(a.h2,{id:"s\xedntoma",children:"S\xedntoma"}),"\n",(0,l.jsxs)(a.p,{children:["Despu\xe9s de configurar ",(0,l.jsx)(a.code,{children:"kubectl"})," en tu m\xe1quina local (copiando ",(0,l.jsx)(a.code,{children:"admin.conf"}),"), los comandos como ",(0,l.jsx)(a.code,{children:"kubectl get nodes"})," o ",(0,l.jsx)(a.code,{children:"k get pods"})," fallan con un error ",(0,l.jsx)(a.code,{children:"i/o timeout"})," al intentar conectar a la IP de tu balanceador de carga (ej: ",(0,l.jsx)(a.code,{children:"192.168.100.7:6443"}),")."]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"k get pods -n kube-system\n"})}),"\n",(0,l.jsxs)(a.p,{children:["Observaste que al ver los logs de HAProxy (",(0,l.jsx)(a.code,{children:"sudo journalctl -u haproxy -f"})," en el LB) mientras intentabas conectar desde local, no aparec\xeda ninguna solicitud de conexi\xf3n."]}),"\n",(0,l.jsx)(a.h2,{id:"diagn\xf3stico",children:"Diagn\xf3stico"}),"\n",(0,l.jsxs)(a.p,{children:["El hecho de que la solicitud no llegara a los logs de HAProxy indica que el tr\xe1fico se estaba bloqueando antes de ser aceptado por el proceso de HAProxy. Dado que ",(0,l.jsx)(a.code,{children:"ping"})," al balanceador funcionaba (conectividad de red b\xe1sica), el sospechoso principal era el firewall en el servidor del balanceador."]}),"\n",(0,l.jsx)(a.h2,{id:"causa-ra\xedz",children:"Causa Ra\xedz"}),"\n",(0,l.jsxs)(a.p,{children:["El firewall (UFW) en el servidor del balanceador (192.168.100.7) ten\xeda una regla conflictiva (",(0,l.jsx)(a.code,{children:"DENY IN Anywhere"}),") que bloqueaba el tr\xe1fico entrante en el puerto 6443 TCP, impidiendo que las conexiones desde tu m\xe1quina local llegaran a HAProxy."]}),"\n",(0,l.jsx)(a.h2,{id:"soluci\xf3n",children:"Soluci\xf3n"}),"\n",(0,l.jsx)(a.p,{children:"Eliminar la regla DENY conflictiva en el firewall del servidor del balanceador y asegurarse de que la regla ALLOW para tu IP local o subred est\xe9 activa para el puerto 6443."}),"\n",(0,l.jsx)(a.h3,{id:"pasos-en-el-servidor-del-balanceador-1921681007",children:"Pasos en el servidor del balanceador (192.168.100.7):"}),"\n",(0,l.jsxs)(a.ol,{children:["\n",(0,l.jsxs)(a.li,{children:["Verifica el estado de UFW (notaste una regla ",(0,l.jsx)(a.code,{children:"6443 DENY IN Anywhere"}),"):","\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"sudo ufw status verbose\n"})}),"\n"]}),"\n",(0,l.jsxs)(a.li,{children:["Elimina la regla DENY conflictiva (la forma m\xe1s segura es por n\xfamero si la tienes listada as\xed con ",(0,l.jsx)(a.code,{children:"ufw status numbered"}),"):","\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'# Primero, lista con n\xfameros para encontrar el n\xfamero de la regla "6443 DENY IN Anywhere"\nsudo ufw status numbered\n# Luego, elimina por su n\xfamero (reemplaza <NUMERO_DE_LA_REGLA_DENY>)\nsudo ufw delete <NUMERO_DE_LA_REGLA_DENY>\n'})}),"\n"]}),"\n",(0,l.jsxs)(a.li,{children:["Recarga UFW para aplicar los cambios:","\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"sudo ufw reload\n"})}),"\n"]}),"\n",(0,l.jsxs)(a.li,{children:["Verifica nuevamente el estado para confirmar que la regla DENY se fue:","\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"sudo ufw status verbose\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"verificaci\xf3n",children:"Verificaci\xf3n"}),"\n",(0,l.jsxs)(a.p,{children:["Despu\xe9s de eliminar la regla DENY y recargar UFW, vuelve a tu m\xe1quina local e intenta el comando ",(0,l.jsx)(a.code,{children:"kubectl get nodes"})," (o ",(0,l.jsx)(a.code,{children:"k get nodes"}),") de nuevo. Ahora deber\xeda poder conectar al balanceador y mostrar el estado de tus nodos."]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl get nodes\n"})})]})}function u(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}}}]);