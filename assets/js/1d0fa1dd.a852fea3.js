"use strict";(self.webpackChunkes_documentacion_devops=self.webpackChunkes_documentacion_devops||[]).push([[7560],{8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>i});var a=r(6540);const s={},o=a.createContext(s);function l(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(o.Provider,{value:n},e.children)}},8820:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"kubernetes/instalacion/haproxy-setup","title":"Configuraci\xf3n de HAProxy Load Balancer","description":"Configuramos un servidor dedicado para HAProxy (lb-k8s con IP 192.168.100.7) para balancear la carga del tr\xe1fico dirigido al API Server de Kubernetes (puerto 6443) entre los tres nodos Control Plane. Esto proporciona Alta Disponibilidad para el API Server.","source":"@site/docs/kubernetes/instalacion/02-haproxy-setup.md","sourceDirName":"kubernetes/instalacion","slug":"/kubernetes/instalacion/haproxy-setup","permalink":"/devsecops-playground/docs/kubernetes/instalacion/haproxy-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/kubernetes/instalacion/02-haproxy-setup.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Configuraci\xf3n de HAProxy Load Balancer"},"sidebar":"tutorialSidebar","previous":{"title":"Pre-requisitos del Sistema","permalink":"/devsecops-playground/docs/kubernetes/instalacion/prerequisitos"},"next":{"title":"Inicializar el Primer Control Plane","permalink":"/devsecops-playground/docs/kubernetes/instalacion/kubeadm-init"}}');var s=r(4848),o=r(8453);const l={sidebar_position:2,title:"Configuraci\xf3n de HAProxy Load Balancer"},i="Configuraci\xf3n de HAProxy Load Balancer",t={},d=[];function c(e){const n={code:"code",h1:"h1",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"configuraci\xf3n-de-haproxy-load-balancer",children:"Configuraci\xf3n de HAProxy Load Balancer"})}),"\n",(0,s.jsxs)(n.p,{children:["Configuramos un servidor dedicado para HAProxy (",(0,s.jsx)(n.code,{children:"lb-k8s"})," con IP 192.168.100.7) para balancear la carga del tr\xe1fico dirigido al API Server de Kubernetes (puerto 6443) entre los tres nodos Control Plane. Esto proporciona Alta Disponibilidad para el API Server."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pasos en el servidor del balanceador (192.168.100.7):"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Instalar HAProxy:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install -y haproxy\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configurar HAProxy:"}),"\nEdita el archivo de configuraci\xf3n principal de HAProxy."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/haproxy/haproxy.cfg\n"})}),"\n",(0,s.jsx)(n.p,{children:"A\xf1ade o modifica las siguientes secciones para configurar el frontend que escucha en la IP del balanceador y el backend que lista los nodos Control Plane:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cfg",children:"# Configuraci\xf3n de HAProxy para Kubernetes API Server\n# ... (otras configuraciones por defecto de HAProxy pueden estar aqu\xed)\n\n# Frontend para el API Server de Kubernetes\nfrontend kubernetes-api\n  bind 192.168.100.7:6443  # **Reemplaza 192.168.100.7 con la IP de tu servidor balanceador**\n  mode tcp\n  option tcplog\n  default_backend kubernetes-api-nodes\n\n# Backend para los nodos Control Plane (Maestros)\nbackend kubernetes-api-nodes\n  mode tcp\n  balance roundrobin # Estrategia de balanceo (ej: roundrobin)\n  option tcp-check\n  server k8s-master-01 192.168.100.12:6443 check fall 2 rise 1\n  server k8s-master-02 192.168.100.13:6443 check fall 2 rise 1\n  server k8s-master-03 192.168.100.14:6443 check fall 2 rise 1\n  # **Reemplaza IPs y nombres de host con los de tus Control Planes**\n"})}),"\n",(0,s.jsx)(n.p,{children:"Guarda y sal del editor."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Habilitar HAProxy para iniciar al arranque y reiniciarlo:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable haproxy\nsudo systemctl restart haproxy\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Verificar el estado de HAProxy:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status haproxy\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Deber\xeda mostrar ",(0,s.jsx)(n.code,{children:"active (running)"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"[Tu salida de sudo systemctl status haproxy aqu\xed]"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configurar Firewall (UFW) en el servidor del balanceador:"}),"\nAseg\xfarate de que el firewall en el servidor del balanceador permite el tr\xe1fico entrante en el puerto 6443 TCP desde las IPs de tus nodos de Kubernetes y desde tu m\xe1quina local (donde ejecutar\xe1s ",(0,s.jsx)(n.code,{children:"kubectl"}),")."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# En el servidor del balanceador (192.168.100.7)\n# Permite tr\xe1fico a 6443 desde tu subred de nodos y tu IP local\nsudo ufw allow from 192.168.100.0/24 to any port 6443 proto tcp\nsudo ufw allow from 172.16.40.21 to any port 6443 proto tcp # **Reemplaza 172.16.40.21 con la IP de tu m\xe1quina local**\n\n# Si tienes una regla DENY Anywhere para 6443, ELIMINALA (ver troubleshooting)\n# sudo ufw delete deny 6443\n\nsudo ufw reload # Recarga las reglas\nsudo ufw status verbose # Verifica las reglas\n"})}),"\n",(0,s.jsx)(n.p,{children:"[Tu salida de sudo ufw status verbose en el LB aqu\xed]"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Con HAProxy configurado y el firewall abierto, el tr\xe1fico dirigido a 192.168.100.7:6443 ser\xe1 balanceado a los Control Planes."}),"\n",(0,s.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);